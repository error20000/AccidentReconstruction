<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Accident Reconstruction</title>

<link rel="stylesheet" href="arcgis_js_api/library/4.5/dijit/themes/claro/claro.css" />
<link rel="stylesheet" href="arcgis_js_api/library/4.5/esri/css/main.css" />

<link rel="stylesheet" href="css/public.css" />
<link rel="stylesheet" href="css/index2.css" />

<script src="https://cdn.bootcss.com/vue/2.5.16/vue.js" type="text/javascript"></script>
<link href="https://cdn.bootcss.com/element-ui/2.2.2/theme-chalk/index.css" rel="stylesheet">
<script src="https://cdn.bootcss.com/element-ui/2.2.2/index.js" type="text/javascript"></script>
<script>
  	var Center = {lon: 52.60495876771754, lat: 27.468084992891264};
    var ArGis={
    		baseUrl: "arcgis_js_api/library/4.5"
    };
    
    !function() {
    	document.write('<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no, minimal-ui" >');
    	resize();

    	window.onresize = function(){
    		resize();
    	}
    }();
    function resize(){
    	var TARGET_WIDTH = 1366;
    	var scale = (screen.width)  / TARGET_WIDTH;
    	document.querySelector('meta[name="viewport"]').setAttribute('content', 'width=' + TARGET_WIDTH + ', initial-scale=' + scale + ', minimum-scale=' + scale + ', maximum-scale=' + scale + ', user-scalable=0, minimal-ui' );
    }
  </script>
<script src="arcgis_js_api/library/4.5/init.js"></script> 

<link rel="stylesheet" href="css/play.css" />

<script src="js/shipInfoData.js" ></script>
<script src="js/shipEventData.js"></script>
<script src="js/shipTimeData.js"></script>
<script src="js/shipTrackData.js"></script>

<!--<script src="js/ship.js"></script>-->
<script src="js/data.js"></script>

<script src="js/utils.js"></script>
<script src="js/play.js"></script>
<script src="js/index.js"></script>
</head>
<body>

<div class="main" id="app">
	<div class="header">
		<div class="select">
			<el-select v-model="timeSelect" @change="handlerSelectChange">
			    <el-option
			      v-for="item in timeEvent"
			      :label="item.name"
			      :value="item.timeStart">
			    </el-option>
  			</el-select>
		</div>
		<div class="lang">中文 / ENGLISH</div>
	</div>
	<div class="content">
		<div class="content_1">
			<div class="content_left">
				<div id="mapDiv" style="height: 290px;"></div>
				<div id="playDiv" style="height: 62px;">
					<play-controller ></play-controller>
				</div>
			</div>
			<div class="content_right">
				<div id="videoDiv">
					<video id="video" controls="controls">
					  <source src="video/test.mp4" type="video/mp4">
						Your browser does not support the video tag.
					</video>
				</div>
			</div>
		</div>
		<div class="content_2">
			<div class="content_left">
				<div class="content_2_1">
					<div class="track_label">显示轨迹</div>
					<div id="trackDiv">
				 		<el-checkbox v-model="isTrackShowPoint" @change="handlerTrackChange('point')">点</el-checkbox>
				 		<el-checkbox v-model="isTrackShowLine" @change="handlerTrackChange('line')">线</el-checkbox>
				 		<el-checkbox v-model="isTrackShowDashed" @change="handlerTrackChange('dashed')">虚线</el-checkbox>
				 		<el-checkbox v-model="isTrackShowShape" @change="handlerTrackChange('shape')">形状</el-checkbox>
				 		<el-checkbox v-model="isTrackShowInfo" @change="handlerTrackChange('info')">事件</el-checkbox>
					</div>
				</div>
				<div class="content_2_2">
					<div class="content_2_2_1">
						<div class="n"> <img alt="" src="images/n.png"></div>
					</div>
					<div class="content_2_2_2">
						<div class="title"></div>
						<div class="info"></div>
					</div>
					<div class="content_2_2_3">
						<div class="title">“1”轮</div>
						<div class="form">
							<div class="form_item">
								<div class="label" style="width: 52px;text-align: center;">船位</div>
								<div class="txt" style="width: 161px;">{{shipsForm[0].lonlat}}</div>
							</div>
							<div class="form_item">
								<div class="label" style="width: 52px;text-align: center;">车</div>
								<div class="txt" style="width: 48px;">{{shipsForm[0].car}}</div>
								<div class="label" style="width: 52px;margin-left: 10px;text-align: center;">船速</div>
								<div class="txt" style="width: 48px;">{{shipsForm[0].speed}}</div>
							</div>
							<div class="form_item">
								<div class="label" style="width: 52px;">罗航向</div>
								<div class="txt" style="width: 48px;">{{shipsForm[0].cc}}</div>
								<div class="label" style="width: 52px;margin-left: 10px;">真航向</div>
								<div class="txt" style="width: 48px;">{{shipsForm[0].tc}}</div>
							</div>
							<div class="form_item">
								<div class="label" style="width: 84px;">值班驾驶员</div>
								<div class="txt" style="width: 128px;">{{shipsForm[0].driver}}</div>
							</div>
							<div class="form_item">
								<div class="label" style="width: 84px;">值班水手</div>
								<div class="txt" style="width: 128px;">{{shipsForm[0].sailor}}</div>
							</div>
							<div class="form_item">
								<div class="label" style="width: 39px;">舵令</div>
								<div class="txt" style="width: 87px;">{{shipsForm[0].ro}}</div>
								<div class="label" style="width: 35px;margin-left: 10px;">时间</div>
								<div class="txt" style="width: 47px;">{{shipsForm[0].time}}</div>
							</div>
							<div class="form_item">
								<div class="label" style="width: 39px;">车令</div>
								<div class="txt" style="width: 87px;">{{shipsForm[0].carl}}</div>
								<div class="label" style="width: 49px;margin-left: 10px;padding-left: 0px">下达人</div>
								<div class="txt" style="width: 33px;">{{shipsForm[0].man}}</div>
							</div>
							<div class="form_item">
								<div class="label" style="width: 157px;">"2"轮距离本船</div>
								<div class="txt" style="width: 54px;">{{shipsForm[0].distance}}</div>
							</div>
							<div class="form_item">
								<div class="label" style="width: 39px;">方位</div>
								<div class="txt" style="width: 82px;">{{shipsForm[0].position}}</div>
							</div>
							<div class="form_item">
								<div class="label" style="width: 39px;">CPA</div>
								<div class="txt" style="width: 87px;">{{shipsForm[0].cpa}}</div>
								<div class="label" style="width: 49px;margin-left: 10px;">TCPA</div>
								<div class="txt" style="width: 33px;">{{shipsForm[0].tcpa}}</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="content_right">
				<div class="content_2_1">
					<div class="weather">{{weatherDesc}}</div>
					<div style="width: 187px;height: 34px;">
						<div class="time_gtc">{{timeDesc}}</div>
						<div class="time_utc">{{timeUTCDesc}}</div>
					</div>
				</div>
				<div class="content_2_2">
					<div class="content_2_2_3">
						<div class="title">“2”轮</div>
						<div class="form">
							<div class="form_item">
								<div class="label" style="width: 52px;text-align: center;">船位</div>
								<div class="txt" style="width: 161px;">{{shipsForm[1].lonlat}}</div>
							</div>
							<div class="form_item">
								<div class="label" style="width: 52px;text-align: center;">车</div>
								<div class="txt" style="width: 48px;">{{shipsForm[1].car}}</div>
								<div class="label" style="width: 52px;margin-left: 10px;text-align: center;">船速</div>
								<div class="txt" style="width: 48px;">{{shipsForm[1].speed}}</div>
							</div>
							<div class="form_item">
								<div class="label" style="width: 52px;">罗航向</div>
								<div class="txt" style="width: 48px;">{{shipsForm[1].cc}}</div>
								<div class="label" style="width: 52px;margin-left: 10px;">真航向</div>
								<div class="txt" style="width: 48px;">{{shipsForm[1].tc}}</div>
							</div>
							<div class="form_item">
								<div class="label" style="width: 84px;">值班驾驶员</div>
								<div class="txt" style="width: 128px;">{{shipsForm[1].driver}}</div>
							</div>
							<div class="form_item">
								<div class="label" style="width: 84px;">值班水手</div>
								<div class="txt" style="width: 128px;">{{shipsForm[1].sailor}}</div>
							</div>
							<div class="form_item">
								<div class="label" style="width: 39px;">舵令</div>
								<div class="txt" style="width: 87px;">{{shipsForm[1].ro}}</div>
								<div class="label" style="width: 35px;margin-left: 10px;">时间</div>
								<div class="txt" style="width: 47px;">{{shipsForm[1].time}}</div>
							</div>
							<div class="form_item">
								<div class="label" style="width: 39px;">车令</div>
								<div class="txt" style="width: 87px;">{{shipsForm[1].carl}}</div>
								<div class="label" style="width: 49px;margin-left: 10px;padding-left: 0px">下达人</div>
								<div class="txt" style="width: 33px;">{{shipsForm[1].man}}</div>
							</div>
							<div class="form_item">
								<div class="label" style="width: 157px;">"1"轮距离本船</div>
								<div class="txt" style="width: 54px;">{{shipsForm[1].distance}}</div>
							</div>
							<div class="form_item">
								<div class="label" style="width: 39px;">方位</div>
								<div class="txt" style="width: 82px;">{{shipsForm[1].position}}</div>
							</div>
							<div class="form_item">
								<div class="label" style="width: 39px;">CPA</div>
								<div class="txt" style="width: 87px;">{{shipsForm[1].cpa}}</div>
								<div class="label" style="width: 49px;margin-left: 10px;">TCPA</div>
								<div class="txt" style="width: 33px;">{{shipsForm[1].tcpa}}</div>
							</div>
						</div>
					</div>
					<div class="content_2_2_4">
						<div class="title">重要描述</div>
						<div class="info">
							<div class="info_container" id="info_container">
								<div class="info_item" v-for="item in msgDesc" v-html='item'>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
	
	require([
	  "esri/Map",
	  "esri/views/MapView",
	  "esri/widgets/ScaleBar",  
	  "esri/widgets/BasemapToggle",
	  "esri/layers/GraphicsLayer",
//      "esri/widgets/Fullscreen",
	  "dojo/domReady!"
	], function(Map, MapView, ScaleBar, BasemapToggle, GraphicsLayer, Fullscreen){
		
		ArGis.map = new Map({
		    basemap: "oceans"
		  });
		ArGis.view = new MapView({
		    container: "mapDiv",  
		    map: ArGis.map,  
		    zoom: 0,  
		    center: ArGis.center
		  });
		
		  var toggle = new BasemapToggle({
		    view: ArGis.view, 
		    nextBasemap: "hybrid"
		  });
	
		  ArGis.view.ui.add(toggle, "top-right");
		  /* ArGis.view.ui.add(new Fullscreen({
		        view: ArGis.view
		  }), "top-right"); */
		
			var scaleBar = new ScaleBar({
				  view: ArGis.view,
				  unit: "dual"
				});
				
			ArGis.view.ui.add(scaleBar, {
			  position: "bottom-left"
			}); 
			
			ArGis.trackLayer = new GraphicsLayer({id:"trackGraphicsLayer"});
			ArGis.shipLayer = new GraphicsLayer({id:"testGraphicsLayer"});
			ArGis.labelLayer = new GraphicsLayer({id:"labelGraphicsLayer"});
			
			ArGis.map.add(ArGis.trackLayer);
			ArGis.map.add(ArGis.shipLayer);
			ArGis.map.add(ArGis.labelLayer);
			
			console.log(ArGis.view);
	  
			ArGis.view.then(function(){
				ArGis.initMap();
				ArGis.initTimeLine();
				ArGis.initShips();
				ArGis.initTrack();
			}); 
			
			ArGis.view.on("click", function(evt){
				console.log(evt);
				console.log(Utils.mercatorToLonLat(evt.mapPoint.x, evt.mapPoint.y));
				console.log(Utils.lonLatToMercator(evt.mapPoint.longitude, evt.mapPoint.latitude));
			});
			
	});
	
new Vue({
    el: '#app',
    data: function() {
      return Config;
    },
    methods: {
    	handlerSelectChange: function(value) {
    		PlayController.curPlayTime = value;
    		PlayController.progress = Number(PlayController.curPlayTime/PlayController.endTime*100);
    		this.msgDesc = [];
  	    },
    	handlerTrack: function(evt) {
    		Config.isTrackShowPoint = true;
  	        ArGis.drawTrack();
  	    },
    	handlerTrackChange: function(type) {
    		if(type == "point"){
    			//移除原来的点
    			ArGis.clearTrackPoint();
    		}else if(type == "line"){
    			//移除原来的线
    			ArGis.clearTrackLine();
    		}else if(type == "dashed"){
    			//移除原来的虚线
    			ArGis.clearTrackDash();
    		}else if(type == "shape"){
    			//移除原来的虚线
    			ArGis.clearTrackShape();
    		}else if(type == "info"){
    			//移除原来的虚线
    			ArGis.clearTrackInfo();
    		}
    		ArGis.drawTrack();
  	    }
    },
    watch: {
    	msgDesc: function () {
   			var div = document.getElementById('info_container');
	       /*  var start = true;
	        function animate () {
	        	if (start) {
	        		div.scrollTop = div.scrollHeight;
	            	if(div.scrollTop == div.scrollHeight){
	            		start = false;
	            	} 
	            	requestAnimationFrame(animate)
	        	}
	        } 
	        animate(); */
	        setTimeout(() => {
	        	div.scrollTop = div.scrollHeight;
	        }, 20);
	        
      	}
    },
    mounted: function(){
		ArGis.initData();
    },
  });
  </script>
</body>
</html>