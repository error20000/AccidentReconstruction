<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Intro to MapView - Create a 2D map</title>
<style>
  html, body, #viewDiv {
    padding: 0;
    margin: 0;
    height: 100%;
    width: 100%;
  }
</style>
    <link rel="stylesheet" href="/arcgis_js_api/library/4.5/dijit/themes/claro/claro.css" />
    <link rel="stylesheet" href="/arcgis_js_api/library/4.5/esri/css/main.css" />
    <!-- <script src="http://127.0.0.1:8085/arcgis_js_api/library/4.5/dojo/dojo.js"></script> -->
    <script src="/arcgis_js_api/library/4.5/init.js"></script>
<script>
var view;
	require([
	  "esri/Map",
	  "esri/views/MapView",  "esri/Graphic", "esri/widgets/ScaleBar",
	  "dojo/domReady!"
	], function(Map, MapView, Graphic, ScaleBar){
	  var map = new Map({
	    basemap: "streets"
	  });
	  view = new MapView({
	    container: "viewDiv",  // Reference to the scene div created in step 5
	    map: map,  // Reference to the map object created before the scene
	    zoom: 0,  // Sets zoom level based on level of detail (LOD)
	    center: [124, 30]  // Sets center point of view using longitude,latitude
	  });
	  
	  var scaleBar = new ScaleBar({
		  view: view,
		  unit: "dual"
		});
		// Add widget to the bottom left corner of the view
		view.ui.add(scaleBar, {
		  position: "bottom-left"
		});
	  
	  /* var mapExtentChange = map.on("extent-change", changeHandler);

	  function changeHandler(evt){
	    var extent = evt.extent,
	        zoomed = evt.levelChange;
	    // ... Do something ... 
		console.log(evt);
	    // in some cases, you may want to disconnect the event listener
	    //mapExtentChange.remove();
	  } */
	  view.then(function(){
		  /* view.goTo({
              zoom: 12
            }, {duration:4000,speedFactor:1,easing:"out-expro"}); */
		  console.log(view);
		  console.log(view.graphics);
	  });
	  view.on("load", addPoints);   //在地图加载完成之后，调用addPoints方法
	  function addPoints(evt) {
		   /*  for(var i = 0 ,size = arcgis_device_list.length ;i<size;i++){// arcgis_device_list 该变量是从数据库中取得的array ，在这里不写
		        var device = arcgis_device_list[i];
		        var symbol = new esri.symbol.PictureMarkerSymbol(appPath+”/images/lcyd.jpg”, 18, 10);      
		        var pt = new esri.geometry.Point( device.xValue,device.yValue);
		        var attr = {“deviceName”:device.equipmentName};
		        var  infoTemplate = new esri.InfoTemplate(“${deviceName}”, “这里可以写内容，支持html “);          
		        var graphic = new esri.Graphic(pt, symbol,attr,infoTemplate); 
		        mapObj.graphics.add(graphic);   
		    } */
		    
	       /*  var pt = new esri.geometry.Point( 400, 300);       
	        var graphic = new esri.Graphic(pt,); 
	        map.graphics.add(graphic);  */ 

			console.log(evt);
		}
	  
	  /* view.extent = new Extent({
		  xmin: -9177882,
		  ymin: 4246761,
		  xmax: -9176720,
		  ymax: 4247967,
		  spatialReference: {
		    wkid: 102100
		  }
		}); */
		
		// First create a line geometry (this is the Keystone pipeline)
		  var polyline = {
		    type: "polyline",  // autocasts as new Polyline()
		    paths: [
		      [-111.30, 52.68],
		      [-98, 49.5],
		      [-93.94, 29.89]
		    ]
		  };

		  // Create a symbol for drawing the line
		  var lineSymbol = {
		    type: "simple-line",  // autocasts as SimpleLineSymbol()
		    color: [226, 119, 40],
		    width: 4
		  };

		  // Create an object for storing attributes related to the line
		  var lineAtt = {
		    Name: "Keystone Pipeline",
		    Owner: "TransCanada",
		    Length: "3,456 km"
		  };

		  /*******************************************
		   * Create a new graphic and add the geometry,
		   * symbol, and attributes to it. You may also
		   * add a simple PopupTemplate to the graphic.
		   * This allows users to view the graphic's
		   * attributes when it is clicked.
		   ******************************************/
		  var polylineGraphic = new Graphic({
		    geometry: polyline,
		    symbol: lineSymbol,
		    attributes: lineAtt,
		    popupTemplate: {  // autocasts as new PopupTemplate()
		      title: "{Name}",
		      content: [{
		        type: "fields",
		        fieldInfos: [{
		          fieldName: "Name",
		          label: "名称"
		        }, {
		          fieldName: "Owner"
		        }, {
		          fieldName: "Length"
		        }]
		      }]
		    }
		  });

		  // Add the line graphic to the view's GraphicsLayer
		  view.graphics.add(polylineGraphic);

		  point(124, 30);
		  point(124, 31);
		  
	  function point(log, lat){
		  var point = {
			type: "point",
		    longitude: log,
		    latitude: lat
		  };

		  var markerSymbol  = {
		    type: "simple-marker",  
		    color: [226, 119, 40],
		    width: 1
		  };

		  var lineAtt = {
		    Name: "Keystone Pipeline",
		    Owner: "TransCanada",
		    Length: "3,456 km"
		  };
		  
		  var pointGraphic = new Graphic({
			    geometry: point,
			    symbol: markerSymbol,
			    attributes: lineAtt,
			    popupTemplate: {  // autocasts as new PopupTemplate()
			      title: "{Name}",
			      content: [{
			        type: "fields",
			        fieldInfos: [{
			          fieldName: "Name"
			        }, {
			          fieldName: "Owner"
			        }, {
			          fieldName: "Length"
			        }]
			      }]
			    }
			  });
		  view.graphics.add(pointGraphic);
		}
	  
	  view.watch("animation", function(response){
		  if(response && response.state === "running"){
		    console.log("Animation in progress");
		  }
		  else{
		   console.log("No animation");
		  }
		});
	  
	  /* view.on("click", function(evt){
		  // Print out the current state of the
		  // drag event.
		  view.goTo({
	              zoom: 12
	            }, {duration:4000,speedFactor:1,easing:"linear"});
		 }); */
		 
		 view.on("click", function(event){
			  var graphic = new Graphic({
			    geometry: event.mapPoint,
			    symbol: {
			      type: "simple-marker",  // autocasts as new SimpleMarkerSymbol()
			      color: "blue",
			      size: 8,
			      outline: {  // autocasts as new SimpleLineSymbol()
			        width: 0.5,
			        color: "darkblue"
			      }
			    }
			  });
			  view.graphics.add(graphic);
			  console.log(view.graphics);
			});
	   
	  view.on("drag", function(evt){
		  // Print out the current state of the
		  // drag event.
			console.log(evt);
		 });
	  
	  view.on("mouse-wheel", function(evt){
		  // Print out the current state of the
		  // drag event.
			console.log(evt);
			console.log(view);
		 });
	});
	
	
</script>
</head>
<body>
  <div id="viewDiv"></div>
  <div></div>
</body>
</html>